# Конфигурационный файл проекта

Конфигурационный файл является валидным json-файлом, состоящим из одного объекта
нулевого уровня: {}. Внутри этого объекта должно быть определено минимум два блока:
`project` и `maps`.

Соглашение о синтаксисе:
`./` обозначает как базовый URL архива карт, (в демоверсии: `http://rpg.wintersky
.ru/leafletmaps/`), так и путь к файловому корню проекта (в демоверсии на хостинге
`/public_html/leafletmaps/`).

### config->project

Блок project задает основные настройки проекта и содержит следующие поля:

- `alias` -- идентификатор проекта, только латиница и цифры. Адрес проекта
будет `./alias` (в блоке описания карт это поле упоминается как `projectalias`);
- `title` -- заголовок проекта, используется для текста ссылки на проект с главной
страницы архива;
- `description` -- описание проекта, блок текста без разметки;
- `desc_file` -- путь (относительный или глобальный) к файлу описания проекта. Это
должен быть html-файл с разметкой, но без блоков head, script и style. Однако,
допустимы inline-стили в тегах.
- `maps_folder` -- название папки с картами проекта. Если оно пусто, предполагается,
что карты лежат в каталоге `./storage/alias`.

@NB: В настоящее время (версия 0.3) поля description и desc_file не используются (не
отображаются в шаблонах)

### config->viewport

Блок viewport задает параметры отображения, общие для всего проекта. Они могут быть
перекрыты индивидуальными настройками карты. В данный момент этот блок задается как
json-объект и содержит всего две опции: `width` и `height`, задающие ширину и высоту
div-а, в который выводится карта.

Кроме того, область вывода (viewport) может быть определена GET-параметрами:
`?width=X&height=Y`.

Отмечу, что приоритеты используемых настроек отображения таковы:

GET-параметры ВАЖНЕЕ настроек конкретной карты, КОТОРЫЕ ВАЖНЕЕ глобальных
настроек проекта.

Если блоки viewport отсутствуют и у карты, и у проекта - используются значения по
умолчанию: `width=800`, `height=600` (смотри константы LFME_VIEWPORT_*)

### config->maps

Блок maps является массивом объектов, содержащих описание конкретных карт. Он может
быть пустым:
```
"maps": []
```
Эта ситуация обрабатывается нормально - просто не будет ссылок на карты.

### config->maps->...

Теперь разберем структуру блока описания конкретной карты.

Этот блок также является json-объектом и состоит как минимум из трех объектов: `info`, `image`, `zoom`.

Все опции (если не указано обратного) являются обязательными -- без них или не заработает, или сломается.

* `info` -- основная информация о карте.
  * `alias` -- идентификатор карты, только латиница и цифры. URL-адрес карты будет `
./projectalias/alias`;
  * `title` -- название карты. Значение может быть пустым.
  * `description` -- описание карты, блок текста без разметки.
  * `desc_file` -- ссылка на файл описания карты (аналогично
config->project->desc_file), но в версии 0.3 не используется;
* `image` -- описывает файл карты:
  * `url` -- относительный или абслютный путь до файла с картой. Файл может быть любым
 изображением, которое может распознать браузер (в частности,
 современные браузеры спокойно понимают и svg-файл как картинку);
  * `width` -- ширина изображения в пикселях;
  * `height` -- высота изображения в пикселях;
* `zoom` -- задает настройки зума и центровки карты. Важно: в настоящее время у меня
нет чёткого понимания, как именно эти опции влияют на визуализацию,
поэтому эксперименты  и еще раз эксперименты. В частности,
на зум и центровку влияют размеры изображения в пикселях.
  * `zoom_min` -- минимальный возможный зум;
  * `zoom_max` -- максимальный возможный зум;
  * `zoom_cur` -- зум карты по умолчанию;
  * `center_x` -- определяет центр карты (X-координату), и она, как ни странно,
должна быть отрицательной;
  * `center_y` -- определяет центр карты (Y-координату);
* `viewport` -- задает настройки области отображения конкретной карты. По структуре аналогичен глобальному блоку `viewport`. Если для
 конкретной карты этот блок опущен - используются настройки проекта.

Для полного понимания опций приведу часть конфигурационного файла проекта
Федерация:

```
{
    "project" : {
        "alias": "confederation",
        "title": "Карты Федерации",
        "description": "Федерация",
        "desc_file": "",
        "maps_folder": "confederation"
    },
    "viewport": {
        "width":    800,
        "height":   600
    },
    "maps" : [
        {
            "info": {
                "alias": "confmap",
                "title": "Основная карта Федерации (с радиусами)",
                "description": ""
            },
            "image": {
                "url": "nm_confmap_radius.png",
                "width": 3440,
                "height": 2666
            },
            "zoom": {
                "zoom_min": 2,
                "zoom_max": 5,
                "zoom_cur": 2,
                "center_x": -350,
                "center_y": 100
            }
        },
        {
            "info": {
                "alias": "fomalhauth",
                "title": "Сектор Фомальгаута",
                "description": ""
            },
            "image": {
                "url": "s_nm_fomalgaut.gif",
                "width": 1880,
                "height": 1507
            },
            "zoom": {
                "zoom_min": 1,
                "zoom_max": 5,
                "zoom_cur": 3,
                "center_x": -100,
                "center_y": 120
            }
        }
    ]
}
```

Помните, формат json-объекта гораздо строже обычного javascript-кода и после
последнего объекта в списке (или после последней пары ключ-значение) не должна стоять
запятая. Пример **ошибочного** написания:
```
        "info": {
                "alias": "fomalhauth",
                "title": "Сектор Фомальгаута",
                "description": "",
            },
```
Здесь запятая после `description` лишняя и **гарантированно** приведет к ошибке
парсинга конфигурационного файла.

**Шаблон конфигурационного файла**: `./storage/project.template`